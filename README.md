# File Analysis Backend Service

Сервис для анализа файлов с использованием Spring Integration и Redis для обработки очередей.

## Основные возможности

- **Асинхронная обработка файлов** через Spring Integration Flows
- **Отслеживание прогресса** в реальном времени через WebSocket
- **Отмена обработки** файлов по запросу
- **Хранение истории** анализов с автоматической очисткой
- **Масштабируемая архитектура** с использованием Redis Queues
- **Docker-контейнеризация** для простого развертывания

## Архитектура

### Integration Flows

Сервис использует несколько интеграционных потоков:

1. **File Processing Flow** - основной поток обработки файлов
2. **Cancel Processing Flow** - обработка запросов на отмену
3. **Progress Flow** - отслеживание и уведомление о прогрессе
4. **Analysis Save Flow** - сохранение результатов анализа


## Запуск через Docker

### Требования

- Docker

### Запуск приложения

1. **Клонируйте репозиторий**
2. **Соберите и запустите контейнеры:**

```bash
docker-compose up --build
```

3. **Приложение будет доступно по адресу:** `http://localhost:8080`

### Остановка приложения

```bash
docker-compose down
```

## Конфигурация

### Переменные окружения

| Переменная | Значение по умолчанию | Описание |
|------------|----------------------|-----------|
| `SPRING_REDIS_HOST` | `redis` | Хост Redis |
| `SPRING_REDIS_PORT` | `6379` | Порт Redis |
| `DB_URL` | `jdbc:h2:mem:file_analysis` | URL базы данных H2 |
| `DB_USERNAME` | `sa` | Имя пользователя БД |
| `DB_PASSWORD` | `password` | Пароль БД |
| `SPRING_SERVLET_MULTIPART_MAX_FILE_SIZE` | `50MB` | Максимальный размер файла |
| `SPRING_SERVLET_MULTIPART_MAX_REQUEST_SIZE` | `50MB` | Максимальный размер запроса |
| `APP_UPLOAD_DIR` | `/app/uploads` | Директория для загрузки файлов |
| `APP_MAX_HISTORY_RECORDS` | `10` | Максимум записей в истории |

### Docker Compose сервисы

- **app** - основное приложение Spring Boot (порт 8080)
- **redis** - сервер Redis с persistence (порт 6379)

## Процесс обработки файлов

1. **Загрузка файла** → сохранение в временную директорию
2. **Постановка в очередь** → добавление сообщения в Redis очередь
3. **Обработка** → чтение из очереди и потоковая обработка
4. **Отслеживание прогресса** → WebSocket уведомления
5. **Сохранение результатов** → в базу данных и кэш
6. **Очистка истории** → автоматическое удаление старых записей

## Технологии

- **Spring Boot** - основной фреймворк
- **Spring Integration** - обработка сообщений и flows
- **Redis** - очереди и кэширование статусов
- **H2 Database** - in-memory база данных
- **WebSocket** - real-time уведомления
- **Docker** - контейнеризация
